{% comment %}
Related Thinking posts (tag overlap). Shows up to 3, excluding current page.
{% endcomment %}

{% if page.tags and page.tags.size > 0 %}
  {% assign related = "" %}
  {% assign related_count = 0 %}

  {% assign thinking_posts = site.categories.Thinking | sort: "date" | reverse %}

  {% for post in thinking_posts %}
    {% if post.url != page.url %}
      {% assign shared = 0 %}
      {% for t in page.tags %}
        {% if post.tags contains t %}
          {% assign shared = shared | plus: 1 %}
        {% endif %}
      {% endfor %}

      {% if shared > 0 %}
        {% assign related_count = related_count | plus: 1 %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if related_count > 0 %}
    <div style="height:2.5rem"></div>
    <h2>Related posts</h2>

    {% assign shown = 0 %}
    {% for post in thinking_posts %}
      {% if post.url != page.url and shown < 3 %}
        {% assign shared = 0 %}
        {% for t in page.tags %}
          {% if post.tags contains t %}
            {% assign shared = shared | plus: 1 %}
          {% endif %}
        {% endfor %}

        {% if shared > 0 %}
          <article class="post-card">
            <h3 class="post-title">
              <a href="{{ post.url }}">{{ post.title }}</a>
            </h3>

            <div class="post-meta muted">
              {{ post.date | date: "%-d %b %Y" }}
              <span class="dot">•</span>
              {{ shared }} shared tag{% if shared != 1 %}s{% endif %}
            </div>

            {% if post.excerpt %}
              <p class="post-excerpt">
                {{ post.excerpt | strip_html }}
              </p>
            {% endif %}

            <a class="post-readmore muted" href="{{ post.url }}">Read →</a>
          </article>

          {% assign shown = shown | plus: 1 %}
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endif %}
